# HTTP를 왜 학습해야 하는가

- 모든 것은 HTTP 기반으로 동작한다.
  - 클라이언트와 서버의 통신, 서버와 서버의 통신은 모두 HTTP 기반으로 동작한다.
  - 그러므로 모바일 앱 개발자, 웹 개발자라면 모두 HTTP에 대한 정확한 지식을 지녀야 한다.
    - 그렇다고 HTTP 명세의 모든 것을 알 필요는 없다.
    - 그러나 필요한 부분에 대한 정확한 이해는 반드시 필요하다.



# 인터넷 네트워크

- 클라이언트와 서버는 인터넷을 사이에 두고 통신한다.
  - 인터넷을 사이에 두고 서버와 인터넷이 통신을 하는 방식
    - IP 프로토콜(IP Protocol, Internet Protocol)
    - TCP, UDP



## IP(Internet Protocol)

- 역할
  - 지정한 IP 주소(IP Address)에 데이터 전달
  - 패킷(Packet,Package+Bucket의 합성어)이라는 통신 단위로 데이터 전달



- IP 프로토콜의 동작 방식
  - A(클라이언트)에서 B(서버)로 데이터를 전달한다고 가정
  - A에서 출발지 IP 주소(A의 IP 주소), 목적지 IP 주소(B의 IP 주소), 전송하고자 하는 데이터 등의 정보를 가지고 IP 패킷을 만든다.
  - 생성한 패킷을 인터넷으로 전달한다.
  - 인터넷은 A에서 전달 받은 패킷을 인터넷 노드들을 통해 B까지 전달한다.
  - B에서 전달 받은 후 다시 출발지 IP 주소(B의 IP 주소), 목적지 IP 주소(A의 IP 주소), 전송하고자 하는 데이터 등의 정보를 가지고 IP 패킷을 만든다.
  - 생성한 패킷을 인터넷으로 전달한다.
  - 인터넷은 B에서 전달 받은 패킷을 인터넷 노드들을 통해 A까지 전달한다.



- IP 프로토콜의 한계
  - 비연결성
    - 패킷을 받을 대상이 없거나 서비스 불능 상태(e.g. 패킷을 받을 컴퓨터가 꺼져 있는 경우)여도 패킷 전송
    - 즉, 대상 서버가 패킷을 받을 수 있는 상태인지 모른다.
  - 비신뢰성
    - 중간에 패킷이 사라질 수 있다. 
    - 인터넷 내부의 노드들을 통해 패킷이 전달되는데, 중간에 노드에 이상이 생기면 서버까지의 연결이 끊어지게 되어 패킷이 유실될 수 있다.
    - 패킷이 순서대로 오지 않을 수 있다.
    - 대량의 데이터를 보낼 경우 보통 1,500 byte 단위로 끊어서 보낸다. 2,500 byte의 데이터를 1,500, 1,000 bytr로 끊어서 1,500 byte의 데이터를 먼저 보내고, 1,000 byte의 데이터를 나중에 보낸다 하더라도 인터넷 내부에서 어떤 노드를 거치는가에 따라서 1,000 byte 데이터가 먼저 도착할 수 있다.
  - 프로그램 구분
    - 같은 IP를 사용하는 서버에서 통신하는 애플리케이션이 둘 이상일 수 있다.
    - 예를 들어 내가 사용중인 하나의 IP에서 스트리밍을 통해 음악을 들으면서 웹툰을 볼 수 있다. 이 때 내 IP로 스트리밍 사이트의 패킷과 웹툰 사이트의 패킷이 모두 오게 되는데 이들이 어디서 온 패킷인지 구분할 수 없다.
  - 이와 같은 한계를 극복하기 위해 TCP를 사용한다.



- DNS(Domain Name System)
  - IP의 문제점
    - IP 주소는 100.100.100.1과 같은 형태이기에 기억하기 어렵다는 문제가 있다.
    - 또한 IP 주소는 변경이 가능하므로 IP 주소만 가지고 통신을 하는 것은 한계가 있다.
  - DNS는 도메인 명을 IP 주소로 변환해준다.
    - 서버는 DNS 서버에 도메인 명과 IP 주소를 등록한다.
    - 이후 클라이언트에서 도메인 명으로 접근하면 DNS 서버는 도메인 주소에 해당하는 IP 주소를 반환한다.
    - 이후 클라이언트는 DNS 서버에서 반환 받은 IP 주소로 서버에 접속한다.



## TCP, UDP

- 인터넷 프로토콜 스택의 4계층
  - 애플리케이션 계층(HTTP, FTP)
    - 웹 브라우저, 온라인 게임 등 인터넷을 사용하는 애플리케이션
    - 카카오톡을 통해 친구에게 "안녕!" 이라는 메세지를 보낸다.
    - SOCKET 라이브러리를 통해  OS 계층에 이 메시지를 전달한다.
  - 전송 계층(TCP,UDP)
    - 전송 계층과 인터넷 계층은 OS 계층에 속한다.
    - OS 계층의 TCP는 애플리케이션 계층에서 받은 메세지에 TCP 세그먼트를 씌운다.
    - TCP 세그먼트는 출발지 PORT, 목적지 PORT, 전송 제어, 순서, 검증 정보 등이 포함되어 있다.
  - 인터넷 계층(IP)
    - OS 계층의 IP는 TCP 정보가 씌어진 메세지를 IP 패킷으로 만든다.
    - 결국 패킷에는 IP 정보, TCP, 정보, 메세지 정보가 담기게 된다.
  - 네트워크 인터페이스 계층
    - IP 패킷에 Ethernet frame(상세하게 알 필요는 없다)을 씌운다.
    - LAN 카드를 통해서 Ethernet frame을 씌운 IP 패킷을 인터넷으로 전송한다.



- TCP(전송 제어 프로토콜, Transmission Control Protocol)의 특징
  - 연결 지향
    - TCP 3 way handshake(가상 연결)
    - 우선 연결을 하고 메세지를 보낸다.
    - IP 프로토콜의 한계인 비연결성을 보완
  - 데이터 전달 보증
    - 데이터가 성공적으로 전송 되면 데이터를 받은 서버는 데이터를 잘 받았다는 메세지를 클라이언트에 전달한다.
    - 따라서 패킷이 중간에 누락이 될 경우 알 수 있다.
    - IP 프로토콜의 한계인 비신뢰성을 보완
  - 순서 보장
    - TCP 세그먼트에는 순서에 대한 정보가 담겨 있다.
    - 패킷을 A, B, C 순서로 전송했을 때 A, C, B 순서로 도착했다면 서버는 B 부터 다시 보내라는 메세지를 클라이언트에 전송한다.
    - IP 프로토콜의 한계인 비신뢰성을 보완



- TCP 3 way handshake
  - 클라이언트에서 서버로 SYN(synchronize)이라는 접속 요청 메세지를 보낸다.
  - 서버는 SYN 메세지를 성공적으로 받으면 ACK(Acknowledge)이라는 요청 수락 메세지와 SYN(서버 쪽의 SYN)을 다시 클라이언트로 보낸다.
  - 클라이언트는  ACK+SYN(서버 쪽의 SYN)를 받으면 다시 서버로 ACK를 보낸다.
    - 이때 클라이언트의 ACK에 데이터를 함께 전송 가능하다.
  - 그 후 클라이언트는 데이터를 전송한다.



- UDP(사용자 데이터그램 프로토콜, User Datagram Protocol) 특징
  - 특징이 없는 것이 특징으로 하얀 도화지에 비유된다.
    - 기능이 거의 존재하지 않는다.
    - TCP 3 way handshake도 존재하지 않고, 데이터 전달을 보증하지도 않으면 순서를 보장하지도 않는다.
  - IP와 거의 유사하지만 PORT 정보와 체크섬 정보가 존재한다는 차이가 있다.
    - PORT 정보는 TCP에도 존재한다.
    - PORT는 하나의 IP를 여러 애플리케이션이 사용할 경우 다양한 곳에서 전송 받은 패킷이 어디서 온 것인지 구분하게 해준다.
    - 체크섬은 메세지가 제대로 왔는지 검증해준다.
  - 기능이 많이 없음에도 쓰이는 이유는 기능이 없기에 단순하고 빠르기 때문이다.
    - TCP는 다양한 기능을 지니고 있고 복잡한 과정을 거치기에 커스터마이징해서 사용하는 것이 불가능하다.
    - UDP는 단순한 기능을 지니고 있기에 필요한 기능을 추가하여 사용하는 것이 가능하다.
    - 최근에 부상하고 있다.



- PORT
  - 한 번에 둘 이상을 연결해야 하는 경우
    - 단일 IP를 가진 A라는 클라이언트가 B, C라는 각기 다른 서버와 연결중인 경우.
    - B 서버에는 게임 서버 연결, 게임 내의 보이스 채팅 관련 패킷을 받고, C 서버에서는 웹툰 관련 패킷을 받고 있는 경우 어떤 패킷이 어디서 온 것인지 어떻게 확인 할 것인가.
    - 특히 B 서버의 경우 같은 IP에서 패킷이 전송되고 있으므로 더 구분이 어렵다.
  - PORT는 각 패킷 별로 지정된다.
    - 즉, 같은 서버에서 전송된 패킷이라도 각각의 PORT 주소는 다르므로 이것을 통해 구분이 가능하다.
    - IP 가 아파트라면 PORT가 아파트의 동, 호수라고 할 수 있다.
  - PORT 번호
    - 0~65535까지 할당이 가능하다.
    - 0~1023까지는 잘 알려진 포트로, 사용하지 않는 것이 좋다.









