# 책임 할당하기

- 책임 주도 설계
  - 데이터 중심의 설계에서 책임 중심의 설계로 전환하기 위해서는 다음의 두 가지 원칙을 따라야한다.
    - 데이터보다 행동을 먼저 결정하라.
    - 협력이라는 문맥 안에서 책임을 결정하라.
  - 데이터보다 행동을 먼저 결정하라.
    - 객체에게 중요한 것은 데이터가 아니라 외부에 제공하는 행동이다.
    - 객체지향 설계에서 가장 중요한 것은 적절한 객체에게 적절한 책임을 할당하는 능력이다.
    - 그리고 적절한 책임을 할당할 수 있는 문맥을 제공하는 것이 협력이다.
  - 협력이라는 문맥 안에서 책임을 결정하라.
    - 객체에게 할당된 책임의 품질은 협력에 적합한 정도로 결정된다.
    - 객체에게 할당된 책임이 협력에 어울리지 않는다면 그 책임은 나쁜 것이다.
    - 객체의 입장에서는 책임이 조금 어색해 보이더라도 협력에 적합하다면 그 책임은 좋은 것이다.
    - 책임은 객체의 입장이 아니라 객체가 참여하는 협력에 적합해야 한다.
    - 협력을 시작하는 주체는 메시지 전송자이기 때문에 협력에 적합한 책임이란 메시지 수신자가 아니라 전송자에게 적합한 책임을 의미한다.
    - 즉, 메시지를 전송하는 클라이언트의 의도에 적합한 책임을 할당해야 한다.
    - 협력에 적합한 책임을 수확하기 위해서는 객체를 결정한 후에 메시지를 선택하는 것이 아니라 메시지를 결정한 후에 객체를 선택해야한다.
  - 객체가 메시지를 선택하는 것이 아니라 메시지가 객체를 선택하게 해야 한다.
    - 메시지가 존재하기 때문에 그 메시지를 처리할 객체가 필요한 것이다.
    - 메시지는 클라이언트의 의도를 표현하며, 클라이언트는 어떤 객체가 메시지를 수신할지 알지 못한다
    - 클라이언트는 단지 임의의 객체가 메시지를 수신할 것이라는 사실을 믿고 자신의 의도를 표현한 메시지를 전송할 뿐이다.
    - 메시지를 수신하기로 결정된 객체는 메시지를 처리할 책임을 할당 받게 된다.
    - 메시지를 먼저 결정하기 때문에 송신자는 메시지 수신자에 대한 어떠한 가정도 할 수 없으므로, 전송자 관점에서 수신자는 깔끔하게 캡슐화된다.





## 책임 할당을 위한 GRASP 패턴

- GRASP(General Responsibility Assignment Sofware Pattern)
  - 크레이그 라만이 책임 할당 기법을 패턴 형식으로 제안한 것이다.
  - 객체에게 책임을 할당할 때 지침으로 삼을 수 있는 원칙들의 집합을 패턴 형식으로 정리한 것이다.



- 도메인 개념에서 출발하기
  - 설계를 시작하기 전에 도메인에 대한 대략적인 모습을 그려 보는 것이 유용하다.
    - 도메인 안에는 무수히 많은 개념들이 존재하며 이 도메인 개념들을 책임 할당의 대상으로 사용하면 코드에 도메인의 모습을 투영하기가 좀 더 수월해진다.
    - 따라서 어떤 책임을 할당해야 할 때 가장 먼저 고민해야 하는 유력한 후보는 바로 도메인 개념이다.
    - 설계의 시작 단계에서 개념들의 의미와 관계를 정확히 정의할 필요는 없으며, 책임을 할당 받을 객체들의 종류와 관계에 대한 유용한 정보만 알아낼 수 있다면 충분하다.
  - 단 하나의 정답이라 부를 수 있는 도메인 모델이란 존재하지 않는다.
    - 올바른 구현을 이끌어낼 수만 있다면 모두 올바른 도메인 모델이라 할 수 있다.
    - 많은 사람들이 도메인 모델은 구현과 무관하다고 생각하지만, 이는 사실이 아니다.
    - 도메인 모델은 도메인을 개념적으로 표현한 것이지만 그 안에 포함된 개념과 관계는 구현의 기반이 되어야 한다.
    - 이는 도메인 모델이 구현을 염두에 두고 구조화되는 것이 바람직하다는 것을 의미한다.
    - 반대로 코드의 구조가 도메인을 바라보는 관점을 바꾸기도 한다.



- 정보 전문가에게 책임을 할당하라.
  - 객체는 어떤 책임을 수행하는 전문가라고 할 수 있으며, 책임을 수행할 정보를 알고 있는 객체에게 책임을 할당해야 한다.
    - GRASP에서는 이를 정보 전문가 패턴이라고 부른다.
    - 정보 전문가 패턴은 객체란 상태와 행동을 함께 가지는 단위라는 객체지향의 가장 기본적인 원리를 책임 할당의 관점에서 표현한다.
    - 객체는 특정한 책임을 수행할 수 있는 행동과 행동을 수행하는 데 필요한 정보를 가지고 있다.
    - 책임 수행에 가장 적잘한 정보를 가지고 있는 객체에게 책임을 할당해야 한다.
  - 주의할 점은 정보 전문가 패턴에서 말하는 정보는 객체 내부의 상태와는 다르다는 점이다.
    - 책임을 수행하는 객체가 정보를 알고 있다고 해서 그 정보를 상태로 저장하고 있을 필요는 없다.
    - 객체는 해당 정보를 제공할 수 있는 다른 객체에 대해 알고 있거나, 필요한 정보를 계산해서 제공할 수도 있다.



- 낮은 응집도와 높은 결합도
  - 낮은 결합도 패턴
    - 설계의 전체적인 결합도가 낮게 유지되게 책임을 할당해야 한다는 패턴이다.
    - 낮은 결합도는 설계 결정을 평가할 때 적용할 수 있는 평가 원리다.
    - 여러 가지 방식으로 설계가 가능하다면, 추가적인 의존성이 발생하지 않는 설계가 더 좋은 설계라고 할 수 있다.
  - 높은 응집도 패턴
    - 설계의 전체적인 응집도가 높게 유지되게 책임을 할당해야 한다는 패턴이다.
    - 높은 결합도 역시 설계 결정을 평가할 때 적용할 수 있는 평가 원리다.
    - 여러 방식으로 설계가 가능하다면 높은 응집도를 유지할 수 있는 설계를 선택해야 한다.



- 창조자(CREATOR) 패턴
  - 창조자 패턴은 객체를 생성할 책임을 어떤 객체에게 할당할지에 대한 지침을 제공한다.
    - 객체 A를 생성해야 할 때 아래 조건을 최대한 많이 만족하는 B에게 객체 생성 책임을 할당해야한다.
    - B가 A객체를 포함하거나 참조한다.
    - B가 A객체를 기록한다.
    - B가 A 객체를 긴밀하게 사용한다.
    - B가 A 객체를 초기화하는 데 필요한 데이터를 가지고 있다(이 경우 B는 A에 대한 정보 전문가다)
  - 결합도를 높이지 않고 객체를 생성하기 위한 지침이다.
    - 다른 객체를 생성하기 위해서는 많건 적건 생성하려는 객체에 대한 정보를 알고 있어야한다.
    - 따라서 생성될 객체에 대해서 이미 잘 알고 있거나 해당 객체를 사용해야 하는 객체는 이미 생성 할 객체와 연결(결합)되어 있다고 볼 수 있다.
    - 따라서 생성 될 객체와 이미 연결되어 있는 객체에게 객체의 생성을 맡기면 결합도의 증가 없이 객체를 생성할 수 있게 된다. 

