# 가상머신 소개와 설치

> 아래 내용은 Windows 10 64 bit 기준이다.

- 가상 머신(Virtual Machine)
  - 이름 그대로 진짜 컴퓨터가 아닌 가상으로 존재하는 컴퓨터를 말한다.
  - 가상 머신은 멀티 부팅과 개념이 다르다.
    - 멀티 부팅은 하드디스크나 SSD의 파티션을 분할한 후, 한 번에 하나의 운영체제만 가동할 수 있는 환경이다.
    - 가상 머신은 파티션을 나누지 않고 동시에 여러개의 운영체제를 가동한다.



- 가상 머신 소프트웨어
  - 컴퓨터에 설치된 운영체제 안에 가상의 컴퓨터를 만들고 그 가상의 컴퓨터 안에 또 다른 운영체제를 설치/운영할 수 있도록 제작된 소프트웨어
    - 즉, 가상 머신을 생성하는 소프트웨어를 가상 머신 소프트웨어라고 한다.
  - 용어 정리
    - 호스트 컴퓨터: 실제 컴퓨터
    - 게스트 컴퓨터: 생성된 가상 머신
    - 호스트 운영체제: 호스트 컴퓨터에 설치된 운영체제.
    - 게스트 운영체제: 게스트 컴퓨터에 설치한 소프트웨어.
  - 종류
    - VMware의 VMware vShpere, MS의 Hyper-V, Oracle의 Virtual Box 등이 있다.
    - 모두 무료로 사용이 가능하다.
    - 아래 실습에서는 VMware Workstation을 사용할 것이다.
  - VMware Workstation
    - Pro와 Player로 나뉘어져 있으며 Pro는 유료, Player는 무료이다.
    - Pro는 30일 무료 평가판을 사용 가능하다(평가 기간이 종료되면 가상 머신을 부팅할 수 없지만, 스냅숏이나 네트워크 설정 기능은 계속 사용할 수 있다).
    - Pro를 설치하면 Player도 함께 설치된다.
  
  |                           | Pro                                                          | Player                        |
  | ------------------------- | ------------------------------------------------------------ | ----------------------------- |
  | 호스트 운영체제           | Windows 7 이상의 64 bit Windows                              | 동일                          |
  | 게스트 운영체제           | 모든 16 bit, 32 bit, 64 bit Windows 및 대부분의 리눅스 운영체제 | 동일                          |
  | 라이선스                  | 유료                                                         | 유료 또는 무료(비상업적 용도) |
  | 가상머신 생성 기능        | O                                                            | O                             |
  | 스냅숏 기능               | O                                                            | X                             |
  | 가상 네트워크 사용자 설정 | O                                                            | X                             |
  | 부가기능                  | 여러 부가 기능이 있다.                                       | 부가 기능이 별로 없다.        |



- VMware의 특징
  - 장점
    - 1대의 컴퓨터 만으로 실무 환경과 거의 비슷한 네트워크 환경을 구성할 수 있다.
    - 운영체제의 특정 시점을 저장하는 스냅숏 기능을 사용할 수 있다.
    - 하드디스크 등의 하드웨어를 여러 개 장착해서 테스트가 가능하다.
    - 가상 머신 상태를 저장해두고, 다음에 사용할 때 저장된 상태를 이어서 구동할 수 있다.
  - 단점
    - 적당한 고사양의 컴퓨터가 필요하다.
    - 원할하게 운영하기 위해서는 쿼드 코어 이상급의 CPU와 8GB 이상의 메모리, 넉넉한 여유 공간의 SSD 또는 하드디스크 사용을 권장한다.



- Vmware Workstation 설치

  > https://www.vmware.com/kr.html

  - 위 사이트에 접속해서 VMware Workstation Pro(이하 Pro) 평가판의 설치 파일을 다운 받는다.
  - 설치 파일을 실행하여 설치를 진행하면 되며, 설치 진행 중에 특별히 설정을 변경할 만한 것은 없다.
  - 설치가 완료되면 프로그램을 실행하여 `I want tp try VMware Workstation 16 for 30 days`를 클릭하고 진행한다.
    - 이후 창을 종료하고 VMware Workstation Player(이하 Player)를 실행한다.







# 가상 머신 생성

- 사전 준비
  - 가상머신은 `.vmdk`라는 확장명을 포함한 여러 개의 관련된 파일로 존재하며, 각각의 가상 머신은 지정한 폴더에 생성된다.
  - 폴더에 저장되므로 디스크 공간이 여유로운 드라이브에 생성하는 것을 권장한다.
  - Ubuntu20.04 폴더를 생성하고 그 하위 폴더로 Server, Server(B), Client, WinClient 폴더를 생성한다.
  - 가상 하드디스크의 내부 작동
    - 가상 하드디스크 장착 시 가상머신은 이를 진짜 하드디스크와 동일하게 취급하지만, 호스트 컴퓨터 입장에서 가상 하드디스크는 하나의 커다란 파일(`.vmdk`)이 된다.
    - 이 가상 하드디스크는 가상머신에 20GB(위에서 설정해준 기본 용량)라고 인식시키면서도 실제 물리 파일의 크기는 겨우 10MB 정도로 설정된다.
    - 즉 10MB짜리 하드디스크를 20GB라고 가상머신을 속이는 것이다.
    - 이후 가상머신에 운영체제 등을 설치하면 실제 공간이 필요해지면서 필요한 공간만큼 자동으로 조금씩 늘어나지만, 위에서 설정한 값 이상으로 늘어나지는 않는다.



- 가상 머신 생성하기
  - Player에서 `Create new virtual machine`, 혹은 `new virtual machine`을 클릭한다.
  - New Virtual Machine Wizard의 첫 화면은 운영체제를 설치하는 방법을 선택하는 창인데 우선은 가상 머신만 생성하고, 운영체제는 이후에 설치할 것이기에 `I will install the operating system later`를 체크 후 넘어간다.
  - 이후 운영체제를 선택하는 화면이 나오는데 Ubuntu 64-bit를 선택한다.
  - 이후 가상머신 이름과 가상머신을 저장할 폴더를 지정하는 화면이 나오는데, 이름을 지정해주고, 위에서 생성한 `Ubuntu20.04/Server` 디렉터리를 선택한다.
  - 다음으로 생성중인 가상 머신의 가상 하드디스크 용량을 지정하는 화면이 나온다. 
    - 일단 기본값인 20GB로 설정한다. 
    - `Store virtual disk as a single file`은 하드디스크 파일을 하나의 파일로 관리하겠다는 것이고, 그 뒤의 `Split virtual disk into multiple files`는 여러 개의 파일에 저장하겠다는 것인데, 실제 사용에는 차이가 없다.
    - `Allocate all disk space now`는 가상 하드디스크의 내부적인 작동 방식 처럼 가상 하드디스크를 관리하지 않으며, 실제 설정해준 용량 만큼의 여유 공간이 있어야 되도록 설정하는 것이다.
  - 이후 Finish를 클릭하고 가상 머신 생성을 완료한다.



- 가상 머신에 장착된 부품 변경하기

  - 가상 머신을 선택 후 `Edit virtual machine settings`를 클릭한다.
  - Memory(==RAM) 부분은 호트스 컴퓨터가 가진 메모리를 가상머신과 나눠 갖게 하는 설정이다
    - 예를 들어 컴퓨터에 4GB의 메모리가 장착되어 있다면, 가상 머신을 부팅하는 순간 호스트와 게스트 컴퓨터가 2GB씩 나눠 갖게 된다. 
    - 우분투를 설치하려면 2GB(2048) 정도의 메모리가 필요하므로 최소한 2048로 설정해준다.
  - Processors(==CPU)
    - 호스트 컴퓨터의 CPU가 멀티코어라면 가상머신에도 CPU를 여러 개 할당할 수 있다.
    - 가상머신의 성능에 큰 의미는 없으므로 그냥 1로 둔다.
  - Hard Disk
    - 아래 설명 참조
    - 아래와 같이 20GB로 잡는다고 실제 20GB를 차지하는 것이 아니므로 필요한 만큼 설정해도 된다.
    - 만일 기존 Hard Disk를 삭제하고 80GB짜리 하드디스크를 추가하고 싶다면 기존 Hard Disk를 선택 후 Remove를 눌러 삭제 한 뒤 Add를 눌러 새로운 Hard Disk를 추가하면 된다.
    - Add시에 Select a Disk의 첫 번째 항목인 `Create a new virtual disk`는 새로운 virtual disk를 추가한다는 의미이고, 두 번째 항목인 `Use an existing virtual machine`은 기존에 사용하던 가상 하드디스크(`.vmdk`파일)를 그대로 사용한다는 의미이며, 마지막 항목인 `Use a physical disk`는 진짜 물리적인 하드디스크를 가상머신에 장착한다는 의미이다.
    - `.vmdk`파일의 naming은 `가상머신 이름-숫자.vmdk`와 같이 지정된다.
  - CD/DVD
    - 가상머신에 CD/DVD를 장착한다.
    - 가상 머신에 장착된 CD/DVD는 2가지 방식으로 사용할 수 있는 데, 그 중 하나는 호스트 컴퓨터에 부착된 CD/DVD 장치를 그대로 이용한ㄴ 것이고 다른 하나는 파일로 된 `.iso` 파일을 CD/DVD처럼 사용하는 것이다.
    - 우분투 리눅스 설치를 위해선 `Device status`는 꼭 `Connect at power on`으로 둬야 추후 우분투 리눅스의 설치 DVD를 자동으로 인식한다.

  - Natwork Adapter(==랜카드, NIC, 네트워크 카드)
    - 기본 설정이 NAT 방식이다.
  - 설정이 모두 완료되면 OK를 눌러 설정을 적용한다.



- 가상 머신을 목록에서 제거하고 다시 불러오기
  - 목록에서 제거하기
    - 생성한 가상 머신을 우클릭 후 `Remove from the Library`를 클릭하면 목록에서 제거된다.
    - `Delete from Disk`를 클릭하면 하드디스크에서 완전히 삭제되므로 주의해야 한다.
  - 다시 불러오기
    - 이후 `Player-file-Open` 혹은 `Open a Vritual Machine` 클릭 후 가상머신을 저장했던 폴더의 `.vmx`파일을 선택하면 다시 목록으로 불러와진다. 



- 가상 머신 부팅
  - 부팅 방법
    - 가상 머신 선택 후 `Play virtual machine`을 클릭
    - `Player-Power-Power On`을 클릭
    - 가상 머신 선택 후 우클릭하여 `Power on`을 클릭
    - 메뉴의 초록색 실행 버튼을 클릭
  - 부팅하기
    - `Cannot connect the virtual device sata0~`과 같은 메시지가 나올 수 있는데 컴퓨터에 DVD 장치가 없을 경우 나오는 메시지로, No를 누르고 넘어가면 된다.
    - Operating System not found라는 메시지가 출력되는데 아직 OS를 설치하지 않았기 때문이다.
    - `Player-Power-Shut Down Guest`를 클릭하여 종료한다(경고 메시지가 나올 경우 yes를 클릭한다).
    - 마우스가 작동하지 않을 경우 ctrl+alt를 눌렀다 뗀다.



# VMware 사용 방법

- VMware 핫 키
  - 가상 머신을 가동하면 현재 컴퓨터에서 작동하는 운영체제는 2개 가 된다.
    - 그러나 마우스와 키보드는 1개 밖에 없으므로 마우스의 포커스를 호스트OS와 게스트 OS 사이에 이동이 가능하기 해야 한다.
    - 게스트 OS로 초점을 이동하려면 가상 머신 화면 안의 아무 곳이나 마우스로 클릭하면 된다.
    - 다시 호스트 OS로 마우스 초점을 가져오려면 ctrl+alt를 동시에 눌렀다 떼면 된다.
  - ctrl+alt+delete
    - 이 세 키는 현재 포커스가 게스트OS에 있더라도 호스트 OS까지 영향을 미친다.
    - 따라서 VMware에서는 ctrl+alt+delete 대신 ctrl+alt+insert를 사용하도록 권장한다.
    - 즉, 게스트 OS에서는  ctrl+alt+delete 대신 ctrl+alt+insert를 사용한다.



- VMware Player 종료 시 닫기 옵션
  - 가상 머신을 구동하는 중에 Player 우측 상단의 창 닫기 버튼을 클릭하면 가상 머신의 현재 상태를 정지 또는 종료로 둘 수 있도록 선택하는 화면이 나온다.
  - 정지 상태는 절전 모드와 유사한 상태라고 보면 된다.



- 전체 화면으로 사용하기
  - 게스트 OS를 전체 화면으로 보고 싶다면 VMware 창의 최대화 아이콘을 클릭하거나 마우스의 초점을 VMware 내부로 옮긴 후 ctrl+alt+enter를 누른다.
    - 이전 화면 크기로 돌아가는 것 역시 동일한 방법으로 돌아가면 된다.
  - 전체 화면을 사용하려면 가상머신이 가동되고 있어야 한다.



- 여러 개의 가상머신을 동시에 부팅하기
  - Player는 하나의 가상 머신만 무팅이 가능하다.
  - 따라서 여러 개의 가상머신을 동시에 부팅하려면 Player를 여러 개 실행한 후 각각 다른 가상머신을 부팅해야 한다.



- 네트워크 정보 파악과 변경
  - 정상적인 네트워킹이 이루어지려면 아래 4 가지의 정보를 알아야 한다.
    - IP 주소
    - 서브넷 마스크
    - 게이트웨이 주소
    - DNS 서버 주소
  - cmd에 ipconfig/all을 입력하면 위 정보를 확인 가능하다.
    - `VMware Virtual Ethernet Adapter for VMnet8`부분에 나온 내용을 입력하면 된다.
  - 가상 IP를 생성한다.
    - Pro를 실행한다.
    - 메뉴의 `Edit-Virtual Network Editor`를 클릭한다.
    - 만일 우측 하단에 `Change Settings`가 있으면 클릭하고 경고창에서 <예>를 클릭한다.
    - VMnet8을 선택 후 하단의 Subnet IP의 3 번째 주소 값을 111로 변경하고 OK를 클릭한다(꼭 111일 필요는 없고 변경하고 싶은 값으로 변경해도 된다.).
    - cmd에 ipconfig/all을 입력한 후 `VMware Virtual Ethernet Adapter for VMnet8`부분에 IPv4 주소가 192.168.111.1로 보이면 성공한 것이다.



- 호스트 OS와 게스트 OS 사이의 파일 전송 방법
  - 가장 간편한 방법은 호스트 OS에서 게스트 OS로 보낼 파일을 ISO 파일로 만든 후, 게스트 OS에 CD/DVD를 넣어주는 방법을 사용할 수 있따.
    - ISO 파일을 만들어주는 프리웨어 중 가볍고 빠른 Free ISO Creator를 추천한다.
  - 아직 운영체제를 설치하지 않았으므로 해 볼 순 없지만 대략적인 순서는 다음과 같다.
    - Player 메뉴의 `Removable Devices - CD/DVD (SATA)- Settings`를 선택한다.
    - `Use ISO image file`을 선택한 후 Browse를 클릭해 ISO 파일을 선태한다.
    - 주의할 점은 `Device status` 부분에 `Connected`가 꼭 체크되어 있어야 한다는 것이다.

